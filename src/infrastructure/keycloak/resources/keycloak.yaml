apiVersion: k8s.keycloak.org/v2alpha1
kind: Keycloak
metadata:
  name: keycloak
  namespace: keycloak
spec:
  instances: 1
  db:
    vendor: postgres
    host: postgresql-hl.keycloak.svc.cluster.local
    database: keycloak
    usernameSecret:
      name: keycloak-secret
      key: database-username
    passwordSecret:
      name: keycloak-secret
      key: database-password    
    poolInitialSize: 1
    poolMinSize: 1
    poolMaxSize: 3
  http:
    httpEnabled: true
  hostname:
    strict: false
    hostname: accounts.ecoma.io
  ingress:
    enabled: false
  transaction:
    xaEnabled: false
  additionalOptions:
    - name: proxy-headers
      value: xforwarded

---

apiVersion: k8s.keycloak.org/v2alpha1
kind: KeycloakRealmImport
metadata:
  name: argocd-realm
  namespace: keycloak
spec:
  keycloakCRName: keycloak
  realm:
    id: master
    realm: master
    displayName: Ecoma
    enabled: true
    clients:
      - clientId: argocd
        name: ArgoCD
        description: ArgoCD
        enabled: true
        clientAuthenticatorType: client-secret
        directAccessGrantsEnabled: true
        standardFlowEnabled: true
        serviceAccountsEnabled: true
        publicClient: false
        redirectUris:
          - "https://argocd.ecoma.io/*" 
        webOrigins:
          - "+"
        protocol: openid-connect
        attributes:
          access.token.lifespan: "3600"
        defaultClientScopes:
          - profile
          - email
          - roles
    users:
      - username: admin
        enabled: true
        firstName: Argo
        lastName: Admin
        email: admin@example.com
        emailVerified: true
        realmRoles:
          - realm-admin